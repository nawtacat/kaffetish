<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>EN7</title>
    <!-- Import Fonts -->
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Oswald:wght@500;700&family=Poppins:wght@400;600;700&display=swap" rel="stylesheet">
    
    <style>
        /* --- 1. Root & Body (Immersive Gradient Theme) --- */
        :root {
            --color-bg-panel: rgba(20, 20, 25, 0.5); /* Semi-transparent panel */
            --color-bg-panel-light: rgba(40, 40, 45, 0.4);
            --color-border: rgba(255, 255, 255, 0.1);
            --color-text: #f0f0f5;
            --color-text-dim: #a0a0b0;
            --color-accent: #00a0ff; /* Electric Blue */
            --color-accent-dark: #0077cc;
            --color-danger: #ff4141;
            --color-warning: #f0e000;
            --color-win: #00f0a0; /* Neon Mint for 'Win' */
            --font-main: 'Poppins', 'Helvetica', sans-serif;
            --font-display: 'Oswald', 'Arial', sans-serif;
            --blur-strong: 12px;
            --blur-light: 5px;
        }

        * {
            box-sizing: border-box;
            margin: 0;
            padding: 0;
        }

        html {
            scroll-behavior: smooth;
        }

        body {
            font-family: var(--font-main);
            /* DYNAMIC BACKGROUND SET BY JS */
            background-color: #0f0f12; /* Fallback */
            background-size: 200% 200%; /* For animation */
            transition: background 1.5s ease;
            color: var(--color-text);
            min-height: 100vh;
        }

        /* --- 2. Main App Container --- */
        #app-container {
            width: 100%;
            min-height: 100vh;
            display: flex;
            flex-direction: column;
            padding: 20px;
            gap: 20px;
        }

        /* --- 3. Header --- */
        header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 20px 25px;
            background: var(--color-bg-panel);
            backdrop-filter: blur(var(--blur-strong));
            -webkit-backdrop-filter: blur(var(--blur-strong));
            border: 1px solid var(--color-border);
            border-radius: 16px;
            
            /* Sticky header */
            position: sticky;
            top: 20px;
            z-index: 100;
        }

        header h1 {
            font-family: var(--font-display);
            font-size: 1.8rem;
            color: var(--color-text);
            text-transform: uppercase;
            letter-spacing: 1px;
        }

        header h1 span {
            color: var(--color-accent);
            font-weight: 700;
        }

        #balance-display {
            font-family: var(--font-display);
            font-size: 1.4rem;
            font-weight: 700;
            color: var(--color-win);
            background-color: rgba(0, 0, 0, 0.3);
            padding: 8px 14px;
            border-radius: 8px;
            letter-spacing: 1px;
        }

        /* --- 4. Main Content Area --- */
        main {
            width: 100%;
            flex-grow: 1;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
        }

        .hidden {
            display: none !important;
        }

        /* --- 5. Betting UI --- */
        #betting-ui {
            width: 100%;
            display: flex;
            flex-direction: column;
            align-items: center;
            gap: 30px;
        }

        #betting-ui h2 {
            font-family: var(--font-display);
            font-size: 1.3rem;
            color: var(--color-text-dim);
            text-transform: uppercase;
            letter-spacing: 1.5px;
            text-align: center;
            background: rgba(0, 0, 0, 0.2);
            padding: 5px 15px;
            border-radius: 8px;
        }

        .matchup-container {
            display: flex;
            justify-content: space-around;
            align-items: center;
            width: 100%;
            padding: 20px 0;
        }

        .team {
            display: flex;
            flex-direction: column;
            align-items: center;
            gap: 20px;
            text-align: center;
            width: 300px;
        }

        .team-icon {
            width: 250px; /* LARGE ICONS */
            height: 250px;
            display: flex;
            justify-content: center;
            align-items: center;
        }

        .team-icon img {
            max-width: 100%;
            max-height: 100%;
            height: auto;
            object-fit: contain;
            /* Creative shadow */
            filter: drop-shadow(0 10px 20px rgba(0, 0, 0, 0.4));
        }

        .team-name {
            font-family: var(--font-display);
            font-size: 2rem;
            font-weight: 700;
            line-height: 1.3;
            text-shadow: 0 2px 10px rgba(0, 0, 0, 0.5);
            text-transform: uppercase;
            letter-spacing: 1px;
        }

        .vs {
            font-family: var(--font-display);
            font-size: 5rem; /* Large VS */
            font-weight: 700;
            color: rgba(255, 255, 255, 0.8);
            text-shadow: 0 2px 10px rgba(0, 0, 0, 0.5);
        }
        
        #betting-controls {
            width: 100%;
            max-width: 800px;
            background: var(--color-bg-panel);
            backdrop-filter: blur(var(--blur-strong));
            -webkit-backdrop-filter: blur(var(--blur-strong));
            border: 1px solid var(--color-border);
            border-radius: 16px;
            padding: 25px;
            display: flex;
            flex-direction: column;
            gap: 20px;
        }

        .odds-container {
            display: grid;
            grid-template-columns: 1fr 1fr 1fr;
            gap: 15px;
        }

        .odd-option {
            background-color: var(--color-bg-panel-light);
            border: 2px solid var(--color-border);
            padding: 15px;
            border-radius: 8px;
            text-align: center;
            cursor: pointer;
            transition: all 0.2s ease;
        }

        .odd-option:hover {
            border-color: var(--color-accent);
            transform: translateY(-2px);
        }

        .odd-option.selected {
            background-color: var(--color-accent);
            border-color: var(--color-accent);
            color: #0f0f12;
            transform: scale(1.05);
            box-shadow: 0 0 20px rgba(0, 160, 255, 0.5);
        }

        .odd-option .label {
            font-size: 0.9rem;
            font-weight: 600;
            margin-bottom: 8px;
            color: var(--color-text-dim);
            text-transform: uppercase;
            letter-spacing: 0.5px;
        }
        
        .odd-option.selected .label {
            color: #0f0f12;
            font-weight: 700;
        }

        .odd-option .value {
            font-family: var(--font-display);
            font-size: 1.5rem;
            font-weight: 700;
            letter-spacing: 1px;
        }

        .bet-input-container {
            display: flex;
            gap: 15px;
        }

        input[type="number"] {
            flex-grow: 1;
            font-family: var(--font-display);
            font-size: 1.3rem;
            padding: 12px 15px;
            background-color: rgba(0, 0, 0, 0.3);
            border: 2px solid var(--color-border);
            color: var(--color-text);
            border-radius: 8px;
            outline: none;
            transition: border-color 0.2s ease;
            letter-spacing: 1px;
        }

        input[type="number"]:focus {
            border-color: var(--color-accent);
        }
        
        input::-webkit-outer-spin-button,
        input::-webkit-inner-spin-button { -webkit-appearance: none; margin: 0; }
        input[type=number] { -moz-appearance: textfield; }

        .btn {
            font-family: var(--font-display);
            font-size: 1.2rem;
            font-weight: 700;
            background-color: var(--color-accent);
            color: #0f0f12;
            border: none;
            padding: 12px 20px;
            border-radius: 8px;
            cursor: pointer;
            transition: all 0.2s ease;
            text-transform: uppercase;
            letter-spacing: 1px;
        }

        .btn:hover {
            background-color: var(--color-accent-dark);
            box-shadow: 0 0 15px rgba(0, 160, 255, 0.4);
        }

        .btn:disabled {
            background-color: var(--color-text-dim);
            cursor: not-allowed;
            box-shadow: none;
        }

        /* --- 6. Game Simulation UI --- */
        #game-ui {
            width: 100%;
            max-width: 900px;
            font-family: var(--font-main);
            display: flex;
            flex-direction: column;
            gap: 20px;
        }

        .scoreboard {
            display: grid;
            grid-template-columns: 1fr auto 1fr;
            align-items: center;
            background: var(--color-bg-panel);
            backdrop-filter: blur(var(--blur-strong));
            -webkit-backdrop-filter: blur(var(--blur-strong));
            border: 1px solid var(--color-border);
            padding: 20px;
            border-radius: 16px;
            text-align: center;
        }

        .score-team {
            font-family: var(--font-display);
            font-size: 1.3rem;
            font-weight: 500;
            text-transform: uppercase;
            letter-spacing: 1px;
        }
        
        .score-team.home { text-align: left; }
        .score-team.away { text-align: right; }

        .score-display {
            font-family: var(--font-display);
            font-size: 2.8rem;
            font-weight: 700;
            padding: 0 25px;
            letter-spacing: 2px;
        }

        .game-timer {
            font-family: var(--font-display);
            font-size: 2rem;
            font-weight: 700;
            color: var(--color-accent);
            text-align: center;
        }

        #live-feed {
            height: 400px;
            background: rgba(0, 0, 0, 0.4); /* Darker feed */
            backdrop-filter: blur(var(--blur-light));
            -webkit-backdrop-filter: blur(var(--blur-light));
            border: 1px solid var(--color-border);
            border-radius: 12px;
            padding: 20px;
            overflow-y: auto;
            display: flex;
            flex-direction: column-reverse;
            font-size: 0.95rem;
        }
        
        .event {
            padding: 10px 12px;
            margin-bottom: 6px;
            border-radius: 4px;
            display: flex;
            align-items: flex-start;
            line-height: 1.5;
        }
        
        .event .time {
            font-family: var(--font-display);
            font-weight: 700;
            color: var(--color-text-dim);
            margin-right: 12px;
            flex-shrink: 0;
            font-size: 1rem;
        }
        
        .event .text {
            word-break: break-word;
        }

        .event.commentary {
            color: var(--color-text-dim);
        }

        .event.goal {
            background-color: rgba(0, 240, 160, 0.1);
            color: var(--color-win);
            font-weight: 600;
        }
        
        .event.goal .text::before {
            content: 'âš½ GOAL! ';
            font-weight: 700;
        }

        .event.card-yellow {
            background-color: rgba(240, 224, 0, 0.1);
            color: var(--color-warning);
            font-weight: 600;
        }
        
        .event.card-yellow .text::before {
            content: 'ðŸŸ¨ ';
        }
        
        .event.card-red {
            background-color: rgba(255, 65, 65, 0.1);
            color: var(--color-danger);
            font-weight: 600;
        }
        
        .event.card-red .text::before {
            content: 'ðŸŸ¥ ';
        }
        
        .event.half-time, .event.full-time {
            font-family: var(--font-display);
            background-color: var(--color-bg-panel-light);
            color: var(--color-accent);
            font-weight: 700;
            justify-content: center;
            font-size: 1.1rem;
            text-transform: uppercase;
            letter-spacing: 1px;
        }

        /* --- 7. Post-Game Modal --- */
        #modal-overlay {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(0, 0, 0, 0.7);
            display: flex;
            justify-content: center;
            align-items: center;
            z-index: 1000;
            padding: 20px;
            backdrop-filter: blur(var(--blur-light));
            -webkit-backdrop-filter: blur(var(--blur-light));
        }
        
        #modal {
            background: var(--color-bg-panel);
            backdrop-filter: blur(var(--blur-strong));
            -webkit-backdrop-filter: blur(var(--blur-strong));
            border: 1px solid var(--color-border);
            padding: 30px;
            border-radius: 16px;
            text-align: center;
            box-shadow: 0 10px 40px rgba(0, 0, 0, 0.5);
            width: 100%;
            max-width: 400px;
        }
        
        #modal h2 {
            font-family: var(--font-display);
            font-size: 2.5rem;
            margin-bottom: 15px;
            text-transform: uppercase;
            letter-spacing: 1px;
        }

        #modal-result-win { color: var(--color-win); }
        #modal-result-lose { color: var(--color-danger); }
        #modal-result-push { color: var(--color-text-dim); }

        #modal p {
            font-size: 1.1rem;
            line-height: 1.6;
            margin-bottom: 30px;
            color: var(--color-text);
        }

        /* --- 8. Mobile Responsive --- */
        @media (max-width: 768px) {
            #app-container {
                padding: 10px;
                gap: 10px;
            }

            header {
                padding: 15px;
                top: 10px; /* Sticky top with padding */
            }

            header h1 { font-size: 1.4rem; }
            #balance-display { font-size: 1.2rem; }

            /* Stack the team matchup */
            .matchup-container {
                flex-direction: column;
                gap: 20px;
            }

            .vs {
                transform: rotate(90deg);
                font-size: 2.5rem;
                margin: 10px 0;
            }
            
            .team {
                width: 200px;
            }
            
            .team-icon {
                width: 150px;
                height: 150px;
            }
            .team-name { font-size: 1.5rem; }

            /* Stack the odds buttons */
            .odds-container {
                grid-template-columns: 1fr;
                gap: 10px;
            }
            
            .odd-option .value { font-size: 1.3rem; }

            /* Stack the bet input */
            .bet-input-container {
                flex-direction: column;
            }

            .btn {
                width: 100%;
            }

            /* Game UI */
            .scoreboard {
                padding: 15px;
                gap: 10px;
            }
            .score-team { font-size: 0.9rem; }
            .score-display { font-size: 2rem; padding: 0 10px; }
            .game-timer { font-size: 1.8rem; }
            
            #live-feed { height: 350px; padding: 15px; }

            #modal h2 { font-size: 2rem; }
            #modal p { font-size: 1rem; }
        }

    </style>
</head>
<body>

    <div id="app-container">
        <!-- App Header -->
        <header>
            <h1>EN<span>7</span></h1>
            <div id="balance-display">$1000</div>
        </header>

        <!-- App Main Content -->
        <main>
            <!-- Betting UI -->
            <div id="betting-ui">
                
                <div class="matchup-container">
                    <!-- Home Team -->
                    <div class="team" id="home-team">
                        <div class="team-icon" id="home-team-icon">
                            <!-- Logo will be inserted by JS -->
                        </div>
                        <div class="team-name" id="home-team-name">Home</div>
                    </div>
                    
                    <div class="vs">VS</div>
                    
                    <!-- Away Team -->
                    <div class="team" id="away-team">
                        <div class="team-icon" id="away-team-icon">
                            <!-- Logo will be inserted by JS -->
                        </div>
                        <div class="team-name" id="away-team-name">Away</div>
                    </div>
                </div>

                <div id="betting-controls">
                    <h2>Place Your Bet</h2>
                    <div class="odds-container" id="odds-container">
                        <div class="odd-option" data-bet="home">
                            <div class="label" id="home-bet-label">Home Win</div>
                            <div class="value" id="home-odds">1.85</div>
                        </div>
                        <div class="odd-option" data-bet="draw">
                            <div class="label">Draw</div>
                            <div class="value" id="draw-odds">3.50</div>
                        </div>
                        <div class="odd-option" data-bet="away">
                            <div class="label" id="away-bet-label">Away Win</div>
                            <div class="value" id="away-odds">4.20</div>
                        </div>
                    </div>

                    <div class="bet-input-container">
                        <input type="number" id="bet-amount" placeholder="Enter bet amount..." min="1">
                        <button class="btn" id="place-bet-btn">Place Bet</button>
                    </div>
                </div>
            </div>

            <!-- Game Simulation UI -->
            <div id="game-ui" class="hidden">
                <div class="scoreboard">
                    <div class="score-team home" id="game-home-name">HOME</div>
                    <div class="score-display">
                        <span id="game-home-score">0</span>
                        -
                        <span id="game-away-score">0</span>
                    </div>
                    <div class="score-team away" id="game-away-name">AWAY</div>
                </div>
                
                <div class="game-timer" id="game-timer">00:00</div>
                
                <div id="live-feed">
                    <!-- Events will be added here by JS -->
                </div>
            </div>

        </main>
    </div>

    <!-- Post-Game Result Modal -->
    <div id="modal-overlay" class="hidden">
        <div id="modal">
            <h2 id="modal-result-text">You Won!</h2>
            <p id="modal-details">Your bet on Manchester Reds won. You earned $185!</p>
            <button class="btn" id="next-match-btn">Next Match</button>
        </div>
    </div>


    <script>
        /* --- 1. DATABASE (Clubs, Players) --- */
        
        // --- NOTE ---
        // 'icon' URLs are hotlinked. They may break.
        // 'strength' is the 0-100 rating you requested.
        // 'color' is for the dynamic gradient background.
        
        const DB = {
            clubs: [
                {
                    id: 'MAN_RED',
                    name: 'Manchester United',
                    color: '#DA291C', // United Red
                    icon: 'https://upload.wikimedia.org/wikipedia/en/thumb/7/7a/Manchester_United_FC_crest.svg/1024px-Manchester_United_FC_crest.svg.png',
                    strength: 84, // 0-100 Rating
                    players: [
                        { name: 'Marcus Rashford', position: 'FW', rating: 85 },
                        { name: 'Bruno Fernandes', position: 'MF', rating: 88 },
                        { name: 'Lisandro MartÃ­nez', position: 'DF', rating: 86 },
                        { name: 'Casemiro', position: 'MF', rating: 89 },
                        { name: 'AndrÃ© Onana', position: 'GK', rating: 85 },
                        { name: 'Rasmus HÃ¸jlund', position: 'FW', rating: 79 },
                    ]
                },
                {
                    id: 'MAD_WHITE',
                    name: 'Real Madrid',
                    color: '#FEBE10', // Real Gold
                    icon: 'https://upload.wikimedia.org/wikipedia/en/thumb/5/56/Real_Madrid_CF.svg/1200px-Real_Madrid_CF.svg.png',
                    strength: 92, // 0-100 Rating
                    players: [
                        { name: 'VinÃ­cius Jr.', position: 'FW', rating: 90 },
                        { name: 'Jude Bellingham', position: 'MF', rating: 91 },
                        { name: 'Luka ModriÄ‡', position: 'MF', rating: 87 },
                        { name: 'Antonio RÃ¼diger', position: 'DF', rating: 86 },
                        { name: 'Thibaut Courtois', position: 'GK', rating: 90 },
                        { name: 'Rodrygo', position: 'FW', rating: 86 },
                    ]
                },
                {
                    id: 'BAY_MUNICH',
                    name: 'Bayern Munich',
                    color: '#DC052D', // Bayern Red
                    icon: 'https://upload.wikimedia.org/wikipedia/commons/thumb/1/1b/FC_Bayern_M%C3%BCnchen_logo_%282017%29.svg/1200px-FC_Bayern_M%C3%BCnchen_logo_%282017%29.svg.png',
                    strength: 90, // 0-100 Rating
                    players: [
                        { name: 'Harry Kane', position: 'FW', rating: 91 },
                        { name: 'Jamal Musiala', position: 'MF', rating: 88 },
                        { name: 'Joshua Kimmich', position: 'MF', rating: 89 },
                        { name: 'Matthijs de Ligt', position: 'DF', rating: 87 },
                        { name: 'Manuel Neuer', position: 'GK', rating: 88 },
                        { name: 'Leroy SanÃ©', position: 'FW', rating: 86 },
                    ]
                },
                {
                    id: 'FC_CATALONIA',
                    name: 'FC Barcelona',
                    color: '#A50044', // BarÃ§a Garnet
                    icon: 'https://upload.wikimedia.org/wikipedia/en/thumb/4/47/FC_Barcelona_%28crest%29.svg/1200px-FC_Barcelona_%28crest%29.svg.png',
                    strength: 87, // 0-100 Rating
                    players: [
                        { name: 'Robert Lewandowski', position: 'FW', rating: 89 },
                        { name: 'Pedri', position: 'MF', rating: 87 },
                        { name: 'Gavi', position: 'MF', rating: 85 },
                        { name: 'Ronald AraÃºjo', position: 'DF', rating: 86 },
                        { name: 'Marc-AndrÃ© ter Stegen', position: 'GK', rating: 89 },
                        { name: 'Lamine Yamal', position: 'FW', rating: 80 },
                    ]
                },
                {
                    id: 'LIV_REDS',
                    name: 'Liverpool FC',
                    color: '#C8102E', // Liverpool Red
                    icon: 'https://upload.wikimedia.org/wikipedia/en/thumb/0/0c/Liverpool_FC.svg/1200px-Liverpool_FC.svg.png',
                    strength: 89, // 0-100 Rating
                    players: [
                        { name: 'Mohamed Salah', position: 'FW', rating: 90 },
                        { name: 'Virgil van Dijk', position: 'DF', rating: 89 },
                        { name: 'Alisson Becker', position: 'GK', rating: 89 },
                        { name: 'Trent Alexander-Arnold', position: 'DF', rating: 87 },
                        { name: 'Dominik Szoboszlai', position: 'MF', rating: 85 },
                        { name: 'Darwin NÃºÃ±ez', position: 'FW', rating: 83 },
                    ]
                },
                {
                    id: 'PARIS_SG',
                    name: 'Paris Saint-Germain',
                    color: '#004170', // PSG Blue
                    icon: 'https://upload.wikimedia.org/wikipedia/en/thumb/a/a7/Paris_Saint-Germain_F.C..svg/1200px-Paris_Saint-Germain_F.C..svg.png',
                    strength: 86, // 0-100 Rating
                    players: [
                        { name: 'Kylian MbappÃ©', position: 'FW', rating: 92 },
                        { name: 'Ousmane DembÃ©lÃ©', position: 'FW', rating: 86 },
                        { name: 'Achraf Hakimi', position: 'DF', rating: 85 },
                        { name: 'Marquinhos', position: 'DF', rating: 87 },
                        { name: 'Gianluigi Donnarumma', position: 'GK', rating: 88 },
                        { name: 'Warren ZaÃ¯re-Emery', position: 'MF', rating: 83 },
                    ]
                }
            ]
        };

        /* --- 2. GAME STATE --- */
        let appState = {
            balance: 1000,
            currentGame: null,
            currentBet: null,
            simulation: {
                minute: 0,
                homeScore: 0,
                awayScore: 0,
                gameInterval: null,
                gameSpeedMs: 700 // SLOWED DOWN from 200
            }
        };

        /* --- 3. DOM ELEMENTS --- */
        const DOMElements = {
            body: document.body,
            balanceDisplay: document.getElementById('balance-display'),
            bettingUI: document.getElementById('betting-ui'),
            gameUI: document.getElementById('game-ui'),
            
            homeTeamIcon: document.getElementById('home-team-icon'),
            homeTeamName: document.getElementById('home-team-name'),
            awayTeamIcon: document.getElementById('away-team-icon'),
            awayTeamName: document.getElementById('away-team-name'),
            homeBetLabel: document.getElementById('home-bet-label'),
            awayBetLabel: document.getElementById('away-bet-label'),
            homeOdds: document.getElementById('home-odds'),
            drawOdds: document.getElementById('draw-odds'),
            awayOdds: document.getElementById('away-odds'),
            oddsContainer: document.getElementById('odds-container'),
            betAmountInput: document.getElementById('bet-amount'),
            placeBetBtn: document.getElementById('place-bet-btn'),

            gameHomeName: document.getElementById('game-home-name'),
            gameAwayName: document.getElementById('game-away-name'),
            gameHomeScore: document.getElementById('game-home-score'),
            gameAwayScore: document.getElementById('game-away-score'),
            gameTimer: document.getElementById('game-timer'),
            liveFeed: document.getElementById('live-feed'),

            modalOverlay: document.getElementById('modal-overlay'),
            modalResultText: document.getElementById('modal-result-text'),
            modalDetails: document.getElementById('modal-details'),
            nextMatchBtn: document.getElementById('next-match-btn'),
        };

        /* --- 4. CORE FUNCTIONS --- */

        function init() {
            // Set initial background gradient
            DOMElements.body.style.background = `linear-gradient(135deg, ${DB.clubs[0].color} 0%, ${DB.clubs[1].color} 100%)`;
            
            updateBalanceUI();
            setupNewMatch();
            addEventListeners();
        }

        function addEventListeners() {
            DOMElements.oddsContainer.addEventListener('click', (e) => {
                const selectedOption = e.target.closest('.odd-option');
                if (!selectedOption) return;

                DOMElements.oddsContainer.querySelectorAll('.odd-option').forEach(opt => {
                    opt.classList.remove('selected');
                });
                
                selectedOption.classList.add('selected');
                
                const betType = selectedOption.dataset.bet;
                appState.currentBet = {
                    ...appState.currentBet,
                    outcome: betType,
                    odds: appState.currentGame.odds[betType]
                };
            });

            DOMElements.placeBetBtn.addEventListener('click', handlePlaceBet);
            DOMElements.nextMatchBtn.addEventListener('click', resetForNextMatch);
        }

        function setupNewMatch() {
            let clubs = [...DB.clubs];
            let homeIndex = Math.floor(Math.random() * clubs.length);
            let homeTeam = clubs.splice(homeIndex, 1)[0];
            
            let awayIndex = Math.floor(Math.random() * clubs.length);
            let awayTeam = clubs.splice(awayIndex, 1)[0];

            const odds = calculateOdds(homeTeam, awayTeam);
            
            appState.currentGame = { homeTeam, awayTeam, odds };
            appState.currentBet = null;
            
            // *** UPDATE DYNAMIC BACKGROUND ***
            DOMElements.body.style.background = `linear-gradient(135deg, ${homeTeam.color} 0%, ${awayTeam.color} 100%)`;

            // Update Betting UI
            DOMElements.homeTeamIcon.innerHTML = `<img src="${homeTeam.icon}" alt="${homeTeam.name}">`;
            DOMElements.homeTeamName.textContent = homeTeam.name;
            DOMElements.homeBetLabel.textContent = `${homeTeam.name} Win`;
            DOMElements.homeOdds.textContent = odds.home.toFixed(2);
            
            DOMElements.awayTeamIcon.innerHTML = `<img src="${awayTeam.icon}" alt="${awayTeam.name}">`;
            DOMElements.awayTeamName.textContent = awayTeam.name;
            DOMElements.awayBetLabel.textContent = `${awayTeam.name} Win`;
            DOMElements.awayOdds.textContent = odds.away.toFixed(2);
            
            DOMElements.drawOdds.textContent = odds.draw.toFixed(2);
        }

        /**
         * Calculates odds based on team strength (0-100 rating)
         */
        function calculateOdds(home, away) {
            // This logic uses the 0-100 strength rating
            const strengthDiff = home.strength - away.strength;
            
            let homeProb = 0.45, drawProb = 0.25, awayProb = 0.30;
            
            // Home advantage + strength diff
            // A 10-point strength diff (e.g., 90 vs 80) = 0.02 advantage
            // Total advantage = 0.05 (home) + 0.02 (strength) = 0.07
            const advantage = (strengthDiff / 100) * 0.2 + 0.05; 
            
            homeProb += advantage;
            awayProb -= advantage;
            
            // Normalize
            const totalProb = homeProb + drawProb + awayProb;
            homeProb /= totalProb;
            drawProb /= totalProb;
            awayProb /= totalProb;

            // Convert to odds with a house edge
            const margin = 0.05; // 5% house edge
            return {
                home: Math.max(1.01, (1 / homeProb) * (1 - margin)),
                draw: Math.max(1.01, (1 / drawProb) * (1 - margin)),
                away: Math.max(1.01, (1 / awayProb) * (1 - margin)),
            };
        }

        function handlePlaceBet() {
            const amount = parseInt(DOMElements.betAmountInput.value, 10);

            // Simple modal alert
            const showModalAlert = (message) => {
                const modal = DOMElements.modalOverlay;
                modal.classList.remove('hidden');
                DOMElements.modalResultText.textContent = "Invalid Bet";
                DOMElements.modalResultText.className = 'modal-result-lose';
                DOMElements.modalDetails.textContent = message;
                DOMElements.nextMatchBtn.textContent = "Try Again";
            }
            
            if (isNaN(amount) || amount <= 0) {
                showModalAlert("Please enter a valid bet amount.");
                return;
            }
            if (amount > appState.balance) {
                showModalAlert("You don't have enough money for that bet.");
                return;
            }
            if (!appState.currentBet || !appState.currentBet.outcome) {
                showModalAlert("Please select an outcome to bet on (Home, Draw, or Away).");
                return;
            }
            
            // If validation passed, hide modal if it was open
            if (!modal.classList.contains('hidden')) {
                 modal.classList.add('hidden');
                 DOMElements.nextMatchBtn.textContent = "Next Match";
            }

            appState.currentBet.amount = amount;
            appState.balance -= amount;
            updateBalanceUI();

            startSimulation();
        }

        function updateBalanceUI() {
            DOMElements.balanceDisplay.textContent = `$${appState.balance}`;
        }

        function startSimulation() {
            DOMElements.bettingUI.classList.add('hidden');
            DOMElements.gameUI.classList.remove('hidden');

            DOMElements.liveFeed.innerHTML = '';
            appState.simulation.minute = 0;
            appState.simulation.homeScore = 0;
            appState.simulation.awayScore = 0;

            const { homeTeam, awayTeam } = appState.currentGame;
            DOMElements.gameHomeName.textContent = homeTeam.name;
            DOMElements.gameAwayName.textContent = awayTeam.name;
            updateScoreboardUI();
            
            addEventToFeed("00:00", "The match has kicked off!", "commentary");
            
            appState.simulation.gameInterval = setInterval(
                gameTick, 
                appState.simulation.gameSpeedMs
            );
        }

        function gameTick() {
            appState.simulation.minute++;
            DOMElements.gameTimer.textContent = `${String(appState.simulation.minute).padStart(2, '0')}:00`;

            if (appState.simulation.minute === 45) {
                addEventToFeed("45:00", "Half-Time! The players head to the tunnel.", "half-time");
                return;
            }
            
            if (appState.simulation.minute >= 90) {
                endSimulation();
                return;
            }

            // Event Generation Engine
            const { homeTeam, awayTeam } = appState.currentGame;
            let eventChance = Math.random();
            
            // This logic uses the 0-100 strength rating
            const homeMomentum = (homeTeam.strength / 100) * Math.random();
            const awayMomentum = (awayTeam.strength / 100) * Math.random();

            if (eventChance < 0.025) { // Goal
                if (homeMomentum > awayMomentum) {
                    generateGameEvent('goal', homeTeam);
                } else {
                    generateGameEvent('goal', awayTeam);
                }
            } else if (eventChance < 0.05) { // Card
                if (homeMomentum > awayMomentum) {
                    generateGameEvent('card', homeTeam);
                } else { 
                    generateGameEvent('card', awayTeam);
                }
            } else if (eventChance < 0.25) { // Commentary
                if (homeMomentum > awayMomentum) {
                    generateGameEvent('commentary', homeTeam);
                } else {
                    generateGameEvent('commentary', awayTeam);
                }
            }
        }

        function endSimulation() {
            clearInterval(appState.simulation.gameInterval);
            appState.simulation.gameInterval = null;
            
            DOMElements.gameTimer.textContent = "90:00+";
            addEventToFeed("90:00+", "Full Time! The whistle has blown.", "full-time");
            
            setTimeout(resolveBet, 1500);
        }
        
        function generateGameEvent(type, team) {
            const minute = appState.simulation.minute;
            const timeStr = `${String(minute).padStart(2, '0')}:00`;
            
            const player = team.players[Math.floor(Math.random() * team.players.length)];
            let text = '';
            
            switch (type) {
                case 'goal':
                    const scorer = player;
                    let assister = team.players[Math.floor(Math.random() * team.players.length)];
                    while (assister.name === scorer.name) {
                         assister = team.players[Math.floor(Math.random() * team.players.length)];
                    }
                    
                    text = `${scorer.name} (${team.name}) scores! A brilliant finish, assisted by ${assister.name}.`;
                    
                    if (team.id === appState.currentGame.homeTeam.id) {
                        appState.simulation.homeScore++;
                    } else {
                        appState.simulation.awayScore++;
                    }
                    updateScoreboardUI();
                    addEventToFeed(timeStr, text, 'goal');
                    break;
                    
                case 'card':
                    const cardType = Math.random() > 0.1 ? 'yellow' : 'red';
                    text = `A bad tackle from ${player.name} (${team.name}). The referee shows a ${cardType} card!`;
                    addEventToFeed(timeStr, text, `card-${cardType}`);
                    break;
                    
                case 'commentary':
                    const commentaryTemplates = [
                        `Great build-up play from ${team.name}.`,
                        `${player.name} takes a shot from distance... just wide!`,
                        `What a save! The keeper denies ${player.name} from close range.`,
                        `${team.name} are controlling possession well here.`,
                        `A dangerous cross into the box by ${player.name}, but it's cleared away.`
                    ];
                    text = commentaryTemplates[Math.floor(Math.random() * commentaryTemplates.length)];
                    addEventToFeed(timeStr, text, 'commentary');
                    break;
            }
        }
        
        function addEventToFeed(time, text, type) {
            const eventEl = document.createElement('div');
            eventEl.classList.add('event', type);
            
            eventEl.innerHTML = `<span class="time">${time}</span><span class="text">${text}</span>`;
            
            DOMElements.liveFeed.prepend(eventEl);
        }
        
        function updateScoreboardUI() {
            DOMElements.gameHomeScore.textContent = appState.simulation.homeScore;
            DOMElements.gameAwayScore.textContent = appState.simulation.awayScore;
        }

        function resolveBet() {
            const { homeScore, awayScore } = appState.simulation;
            const { amount, outcome, odds } = appState.currentBet;
            
            let gameResult;
            if (homeScore > awayScore) gameResult = 'home';
            else if (homeScore < awayScore) gameResult = 'away';
            else gameResult = 'draw';
            
            let modalDetailsText = '';
            let winnings = 0;
            
            const modalResult = DOMElements.modalResultText;
            modalResult.className = ''; // Clear previous classes
            DOMElements.nextMatchBtn.textContent = "Next Match";


            if (gameResult === outcome) {
                winnings = Math.floor(amount * odds);
                appState.balance += winnings;
                
                modalResult.textContent = "You Won!";
                modalResult.classList.add('modal-result-win');
                modalDetailsText = `Your bet on ${outcome} won! You've earned $${winnings}.`;
                
            } else {
                modalResult.textContent = "You Lost";
                modalResult.classList.add('modal-result-lose');
                modalDetailsText = `Your $${amount} bet on ${outcome} lost. Better luck next time.`;
            }
            
            DOMElements.modalDetails.textContent = modalDetailsText;
            updateBalanceUI();
            DOMElements.modalOverlay.classList.remove('hidden');
        }

        function resetForNextMatch() {
            // Check if we're just closing an alert modal
            if (DOMElements.nextMatchBtn.textContent === "Try Again") {
                DOMElements.modalOverlay.classList.add('hidden');
                DOMElements.nextMatchBtn.textContent = "Next Match";
                return;
            }
            
            DOMElements.modalOverlay.classList.add('hidden');
            DOMElements.gameUI.classList.add('hidden');
            DOMElements.bettingUI.classList.remove('hidden');
            
            DOMElements.oddsContainer.querySelectorAll('.odd-option').forEach(opt => {
                opt.classList.remove('selected');
            });
            DOMElements.betAmountInput.value = '';
            
            setupNewMatch();
        }


        /* --- 5. START THE APP --- */
        document.addEventListener('DOMContentLoaded', init);

    </script>
</body>
</html>
